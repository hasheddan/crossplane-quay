---
# Source: quay-cp/templates/quay.yaml
apiVersion: batch/v1
kind: Job
metadata:
  name: prep-db
  namespace: "default"
spec:
  backoffLimit: 4
  template:
    spec:
      restartPolicy: Never
      containers:
      - name: prep-db
        image: postgres:9.6
        command: ['psql']
        args: ['-c', 'CREATE EXTENSION IF NOT EXISTS pg_trgm;']
        env:
        - name: PGDATABASE
          value: postgres
        - name: PGHOST
          valueFrom:
            secretKeyRef:
              name: "db-conn"
              key: database-server
        - name: PGUSER
          valueFrom:
            secretKeyRef:
              name: "db-conn"
              key: database-username
        - name: PGPASSWORD
          valueFrom:
            secretKeyRef:
              name: "db-conn"
              key: database-password
        - name: PGPORT
          valueFrom:
            secretKeyRef:
              name: "db-conn"
              key: port
---
# Source: quay-cp/templates/quay.yaml
apiVersion: redhatcop.redhat.io/v1alpha1
kind: QuayEcosystem
metadata:
  name: quayecosystem
  namespace: "default"
spec:
  quay:
    database:
      credentialsSecretName: "db-conn"
    imagePullSecretName: "redhat-quay-pull-secret"
    registryBackends:
      - name: default
        credentialsSecretName: "bucket-conn"
        s3:
          bucketName: "s3buckettestquayredhat"
          host: "s3.us-east-2.amazonaws.com" 
  
  redis:
    credentialsSecretName: "redis-conn"
